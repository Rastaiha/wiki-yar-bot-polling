# wiki-yar-bot-polling
@wiki_rastaa_bot

پیامی که بات تلگرام می‌گیره از نظر تلگرام، سه حالت مهم ممکنه داشته باشه. 

یکی اینکه کامند باشه، مثلاً بزنی /start و ... 

یکی اینکه متنی باشه؛ یعنی یه متنی که کامند نیست بفرستی. 

یکی اینکه callback query باشه. این سومی وقتی میاد که کیبورد گذاشته باشی تو یه پیامی و کاربر روی یکی از دکمه‌ها زده باشه. 

حالا هر کدوم از این‌ها توی polling و webhook روش‌های مختلفی هندل شدن.

در polling...

نوع اول خیلی سرراست هستش؛ یه تابع می‌نویسی و می‌گی هر کامندی که اومد، چه تابعی اجرا شه. خط ۹۵۵-۹۷۳ کد هم برای همین هستش.

نوع دوم این‌جوری هندل شده که یه تابع تایم گذاشتیم؛ توی این تابع یه لیستی هست به اسم rules. هر عضو این لیست یه تاپل هستش به این فرمت (intiail_state, 'text_regex', func, 'next_state_true', 'next_state_false). ایده، شبیه به fsm و اینا بود؛ الان وقتی یه کاربر به پیام می‌ده، این می‌گرده بین ruleها و اونی رو پیدا می‌کنه که initial_stateش به کاربری که پیام داده می‌خونه و text_regexش هم به پیام مچ می‌شه. در اینصورت تابع func رو کال می‌کنه و حالا اون تابع، کارهایی که لازمه رو می‌کنه و اگه true یا false برگردونه هم استیت کاربر عوض می‌شه.

و اما نوع سوم! این توی تابع button هندل شده. اینجوریه که همون موقعی که کیبورد می‌سازی، معلوم می‌کنی که اگه کاربر زد روش چه calback queryای بیاد برات. حالا برای تشخیص راحت کاری که می‌شه کرد، همه رو به فرمت work_id گذاشتیم، بعد توی تابع button وقتی یه چنین چیزی میاد، work چک می‌شه که کلا ببینیم چیکار باید بکنیم. مثلا اگه download_12 بود باید فایل ۱۲ رو دانلود کنیم بدیم دست کاربر.